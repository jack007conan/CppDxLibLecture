<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="github_hu.css" type="text/css" />
</head>
<body>
<h1 id="c講座資料-vol_6">C++講座資料 vol_6</h1>
<h2 id="参照を返す関数">参照を返す関数</h2>
<p>以下の例では、int型の変数hogeを用意し、hogeに対し複数の方法でアクセスしている。<br />hogeは日本では特に意味のない名前を表す。</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#include &lt;iostream&gt;</span>

<span class="co">//int型の変数を用意</span>
<span class="dt">int</span> hoge;

<span class="co">//hogeのポインタを返す関数(ptrはpointerの略)</span>
<span class="dt">int</span>* getptr(){
    <span class="kw">return</span> &amp;hoge;
}

<span class="co">//hogeの参照を返す関数(refはreferenceの略)</span>
<span class="dt">int</span>&amp; getref(){
    <span class="kw">return</span> hoge;
}

<span class="co">//hogeの値を返す関数</span>
<span class="dt">int</span> getnum(){
    <span class="kw">return</span> hoge;
}

<span class="dt">int</span> main(<span class="dt">void</span>){

    hoge = <span class="dv">10</span>;
    std::cout &lt;&lt; hoge &lt;&lt; std::endl;

    *(getptr()) = <span class="dv">20</span>;
    std::cout &lt;&lt; hoge &lt;&lt; std::endl;

    getref() = <span class="dv">30</span>;
    std::cout &lt;&lt; hoge &lt;&lt; std::endl;

    <span class="co">//getnumはhogeの値を返す関数なので、値を代入できない。コメントアウトを外すとコンパイルエラー。</span>
    <span class="co">//getnum() = 40;</span>

    <span class="kw">return</span> <span class="dv">0</span>;
}</code></pre>
<h2 id="シングルトン">シングルトン</h2>
<p>シングルトンは、インスタンス（実体）が一つしか存在しないことが保証される。また、どのオブジェクトからもアクセスできる。<br />扱い次第では、グローバル変数のように機能させることもできる。どのオブジェクトからもアクセスできるのを活かして、どのキーが押されているか保持するクラスとして使ったり、グラフィック、効果音を管理するクラスとして機能させることも出来る。<br />以下の例では、get()関数が初めて呼ばれた時にシングルトンクラスの実体ができる。また、main関数の前にget()関数を呼ぶとエラーが出る。<br />コンストラクタやコピーコンストラクタ、イコール演算子をprivateに置くことで、それらを外部から呼べないようにして、クラス内でしか実体を作れないようにしている。<br />get()関数内にmysingletonクラスの実体が存在し、get()関数はその実体への参照を返すので、get()関数を通してmysingletonクラスの実体にアクセスすることができる。</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#include &lt;iostream&gt;</span>

<span class="kw">class</span> mysingleton{
<span class="kw">private</span>:
mysingleton(){<span class="co">//コンストラクタをprivateに置き、クラス外で生成するのを禁止</span>
    x = <span class="dv">30</span>; 
}

mysingleton(<span class="dt">const</span> mysingleton&amp; r){}<span class="co">//コピーを禁止</span>
mysingleton&amp; <span class="kw">operator</span>=(<span class="dt">const</span> mysingleton&amp; r){} <span class="co">//代入を禁止</span>

<span class="kw">public</span>:
<span class="dt">static</span> mysingleton&amp; get(){
    <span class="dt">static</span> mysingleton inst;
    <span class="kw">return</span> inst;
}

<span class="dt">int</span> x;

<span class="dt">void</span> func(){
    std::cout &lt;&lt; <span class="st">&quot;クラス内の関数が呼ばれました&quot;</span> &lt;&lt; std::endl;
}
};

<span class="dt">int</span> main(){

<span class="co">//get関数を通してアクセス可能</span>
std::cout &lt;&lt; mysingleton::get().x &lt;&lt; std::endl;
mysingleton::get().func();

<span class="co">//直接アクセスするのは無理。コメントを外すとコンパイルエラー</span>
<span class="co">//std::cout &lt;&lt; mysingleton::x &lt;&lt; std::endl;</span>

<span class="kw">return</span> <span class="dv">0</span>;
}</code></pre>
<h2 id="演習">演習</h2>
<ol style="list-style-type: decimal">
<li>シングルトンのクラスmysingletonを作り、以下の関数を実装せよ。必要な変数があれば、自分で考えて実装すること。</li>
</ol>
<ul>
<li>showhoge() : &quot;hoge&quot;と出力する関数</li>
<li>randint(int num)　: 0~(引数に入力された数) のうちランダムな数を返す関数</li>
<li>calledfuncnum() : シングルトン内の関数が呼ばれた回数を返す関数</li>
</ul>
<h2 id="演習dxライブラリ">演習(DXライブラリ)</h2>
<p>（1. 2.…と順番に解いていって下さい。 これまでコードを書いてきたプロジェクトとは別に新しくプロジェクトを作ってください。）</p>
<ol style="list-style-type: decimal">
<li>シングルトンを用いて、キーの状態、マウスの座標を取得できるInputクラスを作成せよ。</li>
</ol>
<p>・必要なメンバ変数、メンバ関数<br />keystate[]　： 各キーが何フレーム押されているかが入っている配列<br />buf[]　： 各キーが押されているかを入れる配列（keystate更新のために使う）<br />mousex,mousey　：　マウス座標<br />update()　：　keystate配列とmousex,mouseyを更新する関数。メインループ内で毎フレーム呼ぶ必要がある。</p>
<ol style="list-style-type: decimal">
<li><p>enemyクラス内にint型のmode変数を作り、mode変数によって敵が多様な動きをするようにせよ。<br />(mode==1なら自機に直進、mode==2ならsin軌道、mode==3なら出た位置で円運動…など)<br />modeの値は敵の生成時にGetRand()などで適当に決めて良い。addenemy関数の引数で指定できても良い。<br />ちなみに、GetRand(3)とすると、0,1,2,3のどれかが返ってくる。0,1,2でないことに注意。</p></li>
<li><p>modeによって敵の色が変わるようにせよ。</p></li>
<li><p>modeをenum型にせよ。クラス内で定義されたenumは、クラス外部からは(クラス名)::(要素の名前)で enumを指定できる。</p></li>
</ol>
<h2 id="ヒントenum型">ヒント：enum型</h2>
<p>クラス内でenumを定義し使用する例。<br />hogeクラスを用意し、enumのpiyoである変数modeを用意し、クラス外部からmodeを変更して出力していっている。</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#include &lt;iostream&gt;</span>

<span class="kw">class</span> hoge{
<span class="kw">public</span>:
    <span class="kw">enum</span> piyo{
        aaa,
        bbb,
        ccc,
    };

    piyo mode;

    <span class="co">//コンストラクタ　modeの初期値をaaaに</span>
    hoge(){
        mode = aaa;
    }

    <span class="co">//modeをセットする関数</span>
    <span class="dt">void</span> setmode(piyo p){
        mode = p;
    }
};

<span class="dt">int</span> main(<span class="dt">void</span>){
    hoge inst;

    <span class="co">//出力。内部的には整数（0から始まる）</span>
    std::cout &lt;&lt; inst.mode &lt;&lt; std::endl;

    <span class="co">//クラス外からアクセスするには「クラス名::項目」とする。</span>
    inst.mode = hoge::bbb;
    <span class="co">//出力</span>
    std::cout &lt;&lt; inst.mode &lt;&lt; std::endl;

    <span class="co">//関数を用いてセット</span>
    inst.setmode(hoge::ccc);
    std::cout &lt;&lt; inst.mode &lt;&lt; std::endl;

    <span class="kw">return</span> <span class="dv">0</span>;
}</code></pre>
</body>
</html>
